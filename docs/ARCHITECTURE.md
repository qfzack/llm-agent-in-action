# é¡¹ç›®æ¶æ„è¯´æ˜

## ğŸ“ æ–°çš„é¡¹ç›®ç»“æ„

é¡¹ç›®å·²é‡æ–°ç»„ç»‡ä¸ºæ¨¡å—åŒ–æ¶æ„ï¼Œä¾¿äºç»´æŠ¤ã€æ‰©å±•å’Œè¿ç§»ã€‚

```
agent_demo/
â”œâ”€â”€ src/                        # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ core/                   # æ ¸å¿ƒåŠŸèƒ½æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ config.py          # é…ç½®ç®¡ç†
â”‚   â”‚   â””â”€â”€ agent.py           # AI Agent æ ¸å¿ƒé€»è¾‘
â”‚   â”œâ”€â”€ services/               # æœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ vector_store.py    # å‘é‡æ•°æ®åº“æœåŠ¡
â”‚   â”‚   â””â”€â”€ document_loader.py # æ–‡æ¡£åŠ è½½æœåŠ¡
â”‚   â”œâ”€â”€ api/                    # API æ¥å£å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ main.py            # FastAPI åº”ç”¨
â”‚   â””â”€â”€ cli/                    # å‘½ä»¤è¡Œå·¥å…·
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ cli.py             # CLI å®ç°
â”‚
â”œâ”€â”€ tests/                      # æµ‹è¯•ç›®å½•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ test_api.py            # API æµ‹è¯•
â”‚
â”œâ”€â”€ scripts/                    # è„šæœ¬å’Œå·¥å…·
â”‚   â”œâ”€â”€ start.sh               # Linux/Mac å¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ start.bat              # Windows å¯åŠ¨è„šæœ¬
â”‚   â””â”€â”€ example_client.py      # å®¢æˆ·ç«¯ç¤ºä¾‹
â”‚
â”œâ”€â”€ docs/                       # ğŸ“š é¡¹ç›®æ–‡æ¡£
â”‚   â”œâ”€â”€ README.md              # æ–‡æ¡£å¯¼èˆª
â”‚   â”œâ”€â”€ QUICKSTART.md          # å¿«é€Ÿå…¥é—¨
â”‚   â”œâ”€â”€ UV_GUIDE.md            # uv æŒ‡å—
â”‚   â”œâ”€â”€ UV_MIGRATION.md        # è¿ç§»è¯´æ˜
â”‚   â”œâ”€â”€ PROJECT_SUMMARY.md     # é¡¹ç›®æ€»ç»“
â”‚   â””â”€â”€ ARCHITECTURE.md        # æ¶æ„è¯´æ˜ï¼ˆæœ¬æ–‡ä»¶ï¼‰
â”‚
â”œâ”€â”€ knowledge_base/             # çŸ¥è¯†åº“æ–‡æ¡£ç›®å½•
â”‚   â””â”€â”€ README.md              # ç¤ºä¾‹æ–‡æ¡£
â”‚
â”œâ”€â”€ data/                       # è¿è¡Œæ—¶æ•°æ®ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”‚   â””â”€â”€ chroma_db/             # å‘é‡æ•°æ®åº“
â”‚
â”œâ”€â”€ run.py                      # CLI å…¥å£
â”œâ”€â”€ server.py                   # æœåŠ¡å™¨å…¥å£
â”œâ”€â”€ pyproject.toml             # é¡¹ç›®é…ç½®
â”œâ”€â”€ requirements.txt           # ä¾èµ–åˆ—è¡¨
â”œâ”€â”€ .env.example               # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ .gitignore                 # Git å¿½ç•¥
â”œâ”€â”€ LICENSE                    # è®¸å¯è¯
â””â”€â”€ README.md                  # ä¸»æ–‡æ¡£
```

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### åˆ†å±‚æ¶æ„

é¡¹ç›®é‡‡ç”¨ç»å…¸çš„åˆ†å±‚æ¶æ„æ¨¡å¼ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      å…¥å£å±‚ (Entry Points)          â”‚
â”‚  run.py / server.py / scripts/      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      æ¥å£å±‚ (Interface Layer)       â”‚
â”‚  src/api/    â”‚    src/cli/          â”‚
â”‚  (FastAPI)   â”‚    (Argparse)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      æ ¸å¿ƒå±‚ (Core Layer)            â”‚
â”‚  src/core/agent.py                  â”‚
â”‚  src/core/config.py                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      æœåŠ¡å±‚ (Service Layer)         â”‚
â”‚  src/services/vector_store.py      â”‚
â”‚  src/services/document_loader.py   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      æ•°æ®å±‚ (Data Layer)            â”‚
â”‚  knowledge_base/  â”‚  data/          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¨¡å—èŒè´£

#### 1. Core (æ ¸å¿ƒå±‚)
- **config.py**: ç»Ÿä¸€çš„é…ç½®ç®¡ç†
- **agent.py**: AI Agent æ ¸å¿ƒé€»è¾‘ï¼ŒRAG å®ç°

#### 2. Services (æœåŠ¡å±‚)
- **vector_store.py**: å‘é‡æ•°æ®åº“çš„å°è£…
- **document_loader.py**: æ–‡æ¡£åŠ è½½å’Œå¤„ç†æœåŠ¡

#### 3. API (æ¥å£å±‚)
- **main.py**: FastAPI åº”ç”¨ï¼Œæä¾› RESTful API

#### 4. CLI (å‘½ä»¤è¡Œå±‚)
- **cli.py**: å‘½ä»¤è¡Œå·¥å…·å®ç°

#### 5. Tests (æµ‹è¯•å±‚)
- **test_api.py**: API æ¥å£æµ‹è¯•

## ğŸ”„ æ•°æ®æµ

### æ–‡æ¡£åŠ è½½æµç¨‹

```
knowledge_base/*.pdf,docx,md,txt
         â†“
DocumentLoader.load_all_documents()
         â†“
TextSplitter.split_documents()
         â†“
VectorStore.add_documents()
         â†“
ChromaDB (data/chroma_db/)
```

### æŸ¥è¯¢æµç¨‹

```
User Query
    â†“
API/CLI Interface
    â†“
AIAgent.chat()
    â†“
VectorStore.query()  â†’  æ£€ç´¢ç›¸å…³æ–‡æ¡£
    â†“
AIAgent.build_context()  â†’  æ„å»ºä¸Šä¸‹æ–‡
    â†“
AIAgent.generate_prompt()  â†’  ç”Ÿæˆæç¤ºè¯
    â†“
OpenAI API  â†’  ç”Ÿæˆå›ç­”
    â†“
Return Response
```

## ğŸ¯ è®¾è®¡åŸåˆ™

### 1. å•ä¸€èŒè´£åŸåˆ™ (SRP)
æ¯ä¸ªæ¨¡å—åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½é¢†åŸŸï¼š
- `config.py` åªç®¡é…ç½®
- `vector_store.py` åªç®¡å‘é‡å­˜å‚¨
- `agent.py` åªç®¡ AI é€»è¾‘

### 2. ä¾èµ–å€’ç½®åŸåˆ™ (DIP)
é«˜å±‚æ¨¡å—ä¸ä¾èµ–ä½å±‚æ¨¡å—ï¼Œéƒ½ä¾èµ–æŠ½è±¡ï¼š
- Core å±‚ä¸ç›´æ¥ä¾èµ–å…·ä½“å®ç°
- é€šè¿‡æ¥å£å’Œé…ç½®è§£è€¦

### 3. å¼€é—­åŸåˆ™ (OCP)
å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ï¼š
- å¯ä»¥è½»æ¾æ·»åŠ æ–°çš„æ–‡æ¡£ç±»å‹
- å¯ä»¥æ›¿æ¢ä¸åŒçš„å‘é‡æ•°æ®åº“
- å¯ä»¥åˆ‡æ¢ä¸åŒçš„ LLM

### 4. æ¥å£éš”ç¦»åŸåˆ™ (ISP)
ä¸åŒçš„æ¥å£æœåŠ¡ä¸åŒçš„å®¢æˆ·ç«¯ï¼š
- API æ¥å£æœåŠ¡ Web å®¢æˆ·ç«¯
- CLI æ¥å£æœåŠ¡å‘½ä»¤è¡Œç”¨æˆ·

## ğŸš€ ä½¿ç”¨æ–¹å¼

### 1. å‘½ä»¤è¡Œæ–¹å¼

```bash
# åŠ è½½æ–‡æ¡£
uv run python run.py load

# äº¤äº’å¼æŸ¥è¯¢
uv run python run.py query

# æŸ¥çœ‹çŠ¶æ€
uv run python run.py status
```

### 2. API æœåŠ¡æ–¹å¼

```bash
# å¯åŠ¨æœåŠ¡å™¨
uv run python server.py

# æˆ–ä½¿ç”¨ uvicorn ç›´æ¥è¿è¡Œ
uv run uvicorn src.api.main:app --reload
```

### 3. è„šæœ¬æ–¹å¼

```bash
# ä½¿ç”¨å¯åŠ¨è„šæœ¬
./scripts/start.sh        # Linux/Mac
scripts\start.bat         # Windows
```

### 4. Python æ¨¡å—æ–¹å¼

```python
from src.core.agent import AIAgent
from src.core.config import settings
from src.services.vector_store import VectorStore

# åˆå§‹åŒ–
vector_store = VectorStore(settings.vector_db_path)
agent = AIAgent(vector_store)

# ä½¿ç”¨
result = agent.chat("ä½ çš„é—®é¢˜")
print(result['answer'])
```

## ğŸ“¦ æ¨¡å—å¯¼å…¥è§„åˆ™

### ç›¸å¯¹å¯¼å…¥
åœ¨ `src/` ç›®å½•å†…ä½¿ç”¨ç›¸å¯¹å¯¼å…¥ï¼š

```python
# åœ¨ src/core/agent.py ä¸­
from ..services.vector_store import VectorStore
from .config import settings
```

### ç»å¯¹å¯¼å…¥
åœ¨æ ¹ç›®å½•è„šæœ¬ä¸­ä½¿ç”¨ç»å¯¹å¯¼å…¥ï¼š

```python
# åœ¨ run.py ä¸­
from src.cli.cli import main
```

## ğŸ”§ æ‰©å±•æŒ‡å—

### æ·»åŠ æ–°çš„æ–‡æ¡£ç±»å‹

åœ¨ `src/services/document_loader.py` ä¸­ï¼š

```python
def load_new_format(self, file_path: Path) -> str:
    # å®ç°æ–°æ ¼å¼åŠ è½½
    pass

# æ³¨å†Œåˆ° loaders å­—å…¸
loaders = {
    '.pdf': self.load_pdf,
    '.newformat': self.load_new_format,  # æ–°å¢
}
```

### åˆ‡æ¢å‘é‡æ•°æ®åº“

åˆ›å»ºæ–°çš„å‘é‡å­˜å‚¨å®ç°ï¼š

```python
# src/services/new_vector_store.py
class NewVectorStore:
    def __init__(self, db_path: str):
        # å®ç°æ–°çš„å‘é‡å­˜å‚¨
        pass
```

ä¿®æ”¹é…ç½®å’Œåˆå§‹åŒ–ä»£ç å³å¯ã€‚

### æ·»åŠ æ–°çš„ API ç«¯ç‚¹

åœ¨ `src/api/main.py` ä¸­ï¼š

```python
@app.post("/new-endpoint")
async def new_endpoint():
    # å®ç°æ–°ç«¯ç‚¹
    pass
```

### æ·»åŠ æ–°çš„ CLI å‘½ä»¤

åœ¨ `src/cli/cli.py` ä¸­ï¼š

```python
def new_command():
    # å®ç°æ–°å‘½ä»¤
    pass

# åœ¨ main() ä¸­æ³¨å†Œ
subparsers.add_parser('new', help='æ–°å‘½ä»¤')
```

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•
æµ‹è¯•å„ä¸ªæ¨¡å—çš„ç‹¬ç«‹åŠŸèƒ½ï¼š

```python
# tests/test_vector_store.py
def test_vector_store():
    store = VectorStore("./test_data")
    # æµ‹è¯•...
```

### é›†æˆæµ‹è¯•
æµ‹è¯•æ¨¡å—é—´çš„åä½œï¼š

```python
# tests/test_integration.py
def test_full_workflow():
    # æµ‹è¯•å®Œæ•´æµç¨‹
    pass
```

### API æµ‹è¯•
æµ‹è¯• HTTP æ¥å£ï¼š

```python
# tests/test_api.py
def test_query_endpoint():
    response = requests.post("/query", json={"query": "æµ‹è¯•"})
    assert response.status_code == 200
```

## ğŸ“ å¼€å‘è§„èŒƒ

### 1. ä»£ç é£æ ¼
- éµå¾ª PEP 8
- ä½¿ç”¨ç±»å‹æ³¨è§£
- æ·»åŠ æ–‡æ¡£å­—ç¬¦ä¸²

### 2. æäº¤è§„èŒƒ
- `feat:` æ–°åŠŸèƒ½
- `fix:` ä¿®å¤
- `docs:` æ–‡æ¡£
- `refactor:` é‡æ„
- `test:` æµ‹è¯•

### 3. åˆ†æ”¯ç®¡ç†
- `main`: ç¨³å®šç‰ˆæœ¬
- `dev`: å¼€å‘ç‰ˆæœ¬
- `feature/*`: åŠŸèƒ½åˆ†æ”¯

## ğŸ”„ è¿ç§»å’Œéƒ¨ç½²

### 1. å¼€å‘ç¯å¢ƒ

```bash
uv sync
uv run python run.py status
```

### 2. ç”Ÿäº§ç¯å¢ƒ

```bash
# ä½¿ç”¨ Docker
docker build -t ai-agent .
docker run -p 8000:8000 ai-agent

# æˆ–ä½¿ç”¨ gunicorn
gunicorn src.api.main:app -w 4 -k uvicorn.workers.UvicornWorker
```

### 3. äº‘éƒ¨ç½²
- æ”¯æŒéƒ¨ç½²åˆ°ä»»ä½•æ”¯æŒ Python çš„äº‘å¹³å°
- ç¯å¢ƒå˜é‡é€šè¿‡ `.env` æ–‡ä»¶é…ç½®
- æ•°æ®ç›®å½•éœ€è¦æŒä¹…åŒ–å­˜å‚¨

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **å‘é‡æ£€ç´¢ä¼˜åŒ–**: è°ƒæ•´ `top_k` å‚æ•°
2. **æ–‡æ¡£åˆ†å—ä¼˜åŒ–**: è°ƒæ•´ `chunk_size` å’Œ `chunk_overlap`
3. **ç¼“å­˜ç­–ç•¥**: æ·»åŠ æŸ¥è¯¢ç»“æœç¼“å­˜
4. **å¹¶å‘å¤„ç†**: ä½¿ç”¨å¼‚æ­¥å¤„ç†æé«˜ååé‡

## ğŸ› ï¸ æ•…éšœæ’æŸ¥

### å¯¼å…¥é”™è¯¯
ç¡®ä¿ä»é¡¹ç›®æ ¹ç›®å½•è¿è¡Œï¼š
```bash
cd /path/to/agent_demo
uv run python run.py
```

### è·¯å¾„é—®é¢˜
æ‰€æœ‰è·¯å¾„ä½¿ç”¨ç›¸å¯¹äºé¡¹ç›®æ ¹ç›®å½•çš„è·¯å¾„ã€‚

### æ¨¡å—æœªæ‰¾åˆ°
æ£€æŸ¥ `__init__.py` æ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å¿«é€Ÿå…¥é—¨](QUICKSTART.md)
- [é¡¹ç›®æ€»ç»“](PROJECT_SUMMARY.md)
- [uv ä½¿ç”¨æŒ‡å—](UV_GUIDE.md)
- [ä¸»æ–‡æ¡£](../README.md)

---

**æ¶æ„æŒç»­æ¼”è¿›ä¸­ï¼Œæ¬¢è¿è´¡çŒ®æ”¹è¿›å»ºè®®ï¼** ğŸš€
